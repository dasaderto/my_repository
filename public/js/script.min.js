var userid=0,userlogdata="";function ButtonOnOff(){""==$(".condoerror").text()&&""==$(".passerror").text()&&""==$(".loginerror").text()&&""!==$("#login").val()&&""!==$("#reg_password").val()&&""!==$("#password2").val()&&$("#regbtn").attr("disabled",!1)}function testLogin(t){return!1===/^[a-zA-Z1-9]+$/.test(t)?($(".loginerror").text("В логине должны быть только латинские буквы"),$("#regbtn").attr("disabled",!0),!1):t.length<4||20<t.length?($(".loginerror").text("В логине должно быть от 4 до 20 символов"),$("#regbtn").attr("disabled",!0),!1):parseInt(t.substr(0,1))?($(".loginerror").text("Логин должен начинаться с буквы"),$("#regbtn").attr("disabled",!0),!1):void $.post("/core/controllers/AuthController.php",{login:$("#login").val()},function(t){if(haveuser=JSON.parse(t),"no"!=haveuser.haveinDB)return $(".loginerror").text(""),!0;$(".loginerror").text("Логин занят").css("color","red").fadeIn(400),$("#regbtn").attr("disabled",!0)})}function checkPassword(){for(var t=$("#reg_password").val(),e=!1,r=!1,a=!1,o=!1,n=0;n<t.length;n++)e||-1=="qwertyuiopasdfghjklzxcvbnm".indexOf(t[n])?r||-1=="QWERTYUIOPLKJHGFDSAZXCVBNM".indexOf(t[n])?a||-1=="0123456789".indexOf(t[n])?o||-1=="!@#$%^&*()_-+=|/.,:;[]{}".indexOf(t[n])||(o=!0):a=!0:r=!0:e=!0;var s=0,l="";return e&&s++,r&&s++,a&&s++,o&&s++,t.length<6&&s<3?l="Простой":t.length<6&&3<=s?l="Средний":8<=t.length&&s<3?l="Средний":8<=t.length&&3<=s?l="Сложный":6<=t.length&&1==s?l="Простой":6<=t.length&&1<s&&s<4?l="Средний":6<=t.length&&4==s&&(l="Сложный"),"Сложный"==l||"Средний"==l?($(".passerror").text(""),!0):($(".passerror").text("Слишком простой пароль").css("color","red"),$("#regbtn").attr("disabled",!0),!1)}function getUrlVars(){var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,r){a[e]=r});return a}function randomString(t,e){for(var r="",a=0,o="a"==(e=e&&e.toLowerCase())?10:0,n="n"==e?10:62;a++<t;){var s=Math.random()*(n-o)+o<<0;r+=String.fromCharCode(s+=9<s?s<36?55:61:48)}return r}function footerToBottom(){var t=$(window).height(),e=$("footer").outerHeight(!0),r=$("main").outerHeight(!0)-$("main").height()+72;$("main").css({"min-height":t-e-r})}$(document).ready(function(){$(".filename").bind("change",function(){20<this.files[0].size/1024/1024&&(noty({text:"Выбранный вами файл превышает максимально допустимые размеры!!!"}),$(".filename").val(""))}),$("#downbtn").bind("click",function(){noty({text:"Подождите полной загрузки всех данных, не закрывайте страницу."})}),$("#regbtn").bind("click",function(){$.post("/core/controllers/AuthController.php",{reg_login:$("#login").val(),reg_password:$("#reg_password").val(),role:$("#role").val(),password2:$("#password2").val()},function(t){regus=JSON.parse(t),"absolutlyNO"==regus.cant?(noty({text:"Регистрация невозможна, проверьте данные, и повторите попытку!!!"}),$("#regbtn").attr("disabled",!0)):(noty({text:"Успешная регистрация!!!"}),setTimeout(function(){document.location.reload(!0)},1500))})}),$("#authbtn").bind("click",function(){$.post("/core/controllers/AuthController.php",{authlogin:$("#authlogin").val(),pass:$("#pass").val()},function(t){result=JSON.parse(t),"true"==result.name?document.location.reload(!0):"false"==result.name&&noty({text:"Вы ввели неверный логин или пароль. Вход невозможен!!!"})})}),$("#load-data").bind("click",function(){""==$("#userload").val()?($(".userloaderror").text("Поле не может быть пустым!!!").css("color","red"),$("#edit-data").attr("disabled",!0),$("#delete-data").attr("disabled",!0)):$.post("/core/controllers/AJAXController.php",{userdata:$("#userload").val()},function(t){dataparse=JSON.parse(t),"no"==dataparse.id?($(".userloaderror").text("Такой пользователь не найден в Базе данных").css("color","red"),$("#edit-data").attr("disabled",!0),$("#delete-data").attr("disabled",!0)):($(".userloaderror").text(""),$("#edit-data").attr("disabled",!1),$("#delete-data").attr("disabled",!1),$("#username").attr("disabled",!1),$("#userole").attr("disabled",!1),$("#userid").val(dataparse.id),userid=dataparse.id,userlogdata=dataparse.username,$("#username").val(dataparse.username),1==dataparse.rank?rank="Студент":2==dataparse.rank?rank="Учитель":rank="Администратор",$("#userole").val(rank))})}),$("#edit-data").bind("click",function(){var e=0;e="студент"==$("#userole").val().toLowerCase()?1:"учитель"==$("#userole").val().toLowerCase()?2:3,"студент"!==$("#userole").val().toLowerCase()&&"учитель"!==$("#userole").val().toLowerCase()&&"администратор"!==$("#userole").val().toLowerCase()&&$(".userolerror").text("Такой роли не существует").css("color","red"),""==$(".userloaderror").val()&&""==$(".userolerror").val()&&noty({text:"Вы уверенны что хотите продолжить редактирование?",buttons:[{addClass:"btn btn-primary",text:"Да",onClick:function(t){console.log(t.$bar.find("input#example").val()),t.close(),$.post("/core/controllers/AuthController.php",{login:$("#username").val(),rolework:userlogdata},function(t){haveuser=JSON.parse(t),"no"==haveuser.haveinDB?$(".userloaderror").text("Изменемый вами логин занят,измените на другой!!!").css("color","red").fadeIn(400):($(".userloaderror").text(""),$.post("/core/controllers/AJAXController.php",{edituserid:userid,editusername:$("#username").val(),edituserrole:e},function(t){dataparse=JSON.parse(t),"AllOk"==dataparse.ok?(noty({text:"Данные успешно отредактированы"}),$("#userid").val(""),$("#username").val(""),$("#userole").val(""),$("#edit-data").attr("disabled",!0),$("#delete-data").attr("disabled",!0)):noty({text:"Неудача, обратитесь к системному администратору."})}))})}},{addClass:"btn btn-danger",text:"Отмена",onClick:function(t){noty({text:"Вы отменили редактирование"}),t.close()}}]})}),$("#delete-data").bind("click",function(){""==$("#userid").vall||""==$("#username").val()||""==$("#userole").val()?noty({text:"Нечего удалять("}):noty({text:"Вы уверенны что хотите удалить данного пользователя?",buttons:[{addClass:"btn btn-primary",text:"Да",onClick:function(t){console.log(t.$bar.find("input#example").val()),t.close(),$.post("/core/controllers/AJAXController.php",{deleteuserid:userid},function(t){dataparse=JSON.parse(t),"UserDeleted"==dataparse.deleted?(noty({text:"Данные успешно удалены!"}),$("#userid").val(""),$("#username").val(""),$("#userole").val(""),$("#edit-data").attr("disabled",!0),$("#delete-data").attr("disabled",!0)):noty({text:"Неудача, обратитесь к системному администратору."})})}},{addClass:"btn btn-danger",text:"Отмена",onClick:function(t){noty({text:"Удаление отменено"}),t.close()}}]})}),$("#userload").keydown(function(){$(".userloaderror").text("")}),$("#userole").keydown(function(){$(".userolerror").text("")})}),$(function(){$("#userload").keyup(function(){$("#edit-data").attr("disabled",!0),$("#delete-data").attr("disabled",!0),$("#username").attr("disabled",!0),$("#userole").attr("disabled",!0)})}),$(function(){$("#login").keyup(function(){login=$("#login").val(),testLogin(login),ButtonOnOff()}),$("#reg_password").keyup(function(){checkPassword(),ButtonOnOff(),$("#reg_password").val()!==$("#password2").val()?($(".condoerror").text("Пароли не совпадают").css("color","red"),$("#regbtn").attr("disabled",!0)):($(".condoerror").text(""),ButtonOnOff())}),$("#password2").keyup(function(){$("#reg_password").val()!==$("#password2").val()?($(".condoerror").text("Пароли не совпадают").css("color","red"),$("#regbtn").attr("disabled",!0)):($(".condoerror").text(""),ButtonOnOff())})}),jQuery(function(){$("#add_stud").bind("click",function(){$("#stud_class").val()<=11&&1<=$("#stud_class").val()&&$("#addDate").val()<=2050&&2018<=$("#addDate").val()&&1<=$("#stud_numb").val()&&$("#stud_numb").val()<=100?$.post("/core/controllers/AJAXController.php",{addstudent:"",class:$("#stud_class").val(),date:$("#addDate").val(),amount:$("#stud_numb").val()},function(t){resultbyadd=JSON.parse(t),"success"==resultbyadd.studadd?(noty({text:"Изменения произведены!"}),$("#stud_class").val(""),$("#stud_numb").val("")):noty({text:"Произошла ошибка, обновите страницу, и повторите снова."})}):noty({text:"Вы ввели некорректные данные!"})})}),jQuery(function(){$("#del_stud").bind("click",function(){$("#stud_class").val()<=11&&1<=$("#stud_class").val()&&$("#addDate").val()<=2050&&2018<=$("#addDate").val()&&1<=$("#stud_numb").val()&&$("#stud_numb").val()<=100?$.post("/core/controllers/AJAXController.php",{addstudent:"",class:$("#stud_class").val(),date:$("#addDate").val(),amount:-$("#stud_numb").val()},function(t){resultbyadd=JSON.parse(t),"success"==resultbyadd.studadd?(noty({text:"Изменения произведены!"}),$("#stud_class").val(""),$("#stud_numb").val("")):noty({text:"Удаляемое вами количество учеников превышает общее количество учеников в данных классах."})}):noty({text:"Вы ввели некорректные данные!"})})}),jQuery(function(){$(".watchhref").bind("click",function(){var t=decodeURIComponent(getUrlVars().book).replace(/\+/g," ").replace(/\./g,"."),e=decodeURIComponent(getUrlVars().bookauthor).replace(/\+/g," ").replace(/\./g,".");$.post("/core/controllers/UserController.php",{inc:"inc",book:t,bookauthor:e},function(t){})})}),jQuery(function(){$("#generate").bind("click",function(){$("#reg_password").attr("type","text"),$("#password2").attr("type","text"),$("#login").val(randomString(10)),$("#reg_password").val(randomString(10)),$("#password2").val($("#reg_password").val())})}),jQuery(function(){$("#reg_password").on("keyup",function(){$("#reg_password").attr("type","password"),$("#password2").attr("type","password")})}),jQuery(function(){$("#password2").on("keyup",function(){$("#reg_password").attr("type","password"),$("#password2").attr("type","password")})}),jQuery(function(){$("#generate").bind("click",function(){$("#reg_password").attr("type","text"),$("#password2").attr("type","text"),$("#login").val(randomString(10)),$("#reg_password").val(randomString(10)),$("#password2").val($("#reg_password").val()),$(".loginerror").text(""),$(".passerror").text(""),$(".condoerror").text(""),testLogin($("#login").val()),checkPassword(),ButtonOnOff()})}),jQuery(function(){$("#add_work").bind("click",function(){$("#work_class").val()<=11&&1<=$("#work_class").val()&&""!==$("#subject").val()&&$("#year_add").val()<=2050&&2e3<=$("#year_add").val()&&$("#shelf_life").val()<=20&&1<=$("#shelf_life").val()?$.post("/core/controllers/AJAXController.php",{addworkbook:"",work_class:$("#work_class").val(),author:$("#author").val(),subject:$("#subject").val(),year_add:$("#year_add").val(),shelf_life:$("#shelf_life").val(),publishing:$("#publishing").val(),amount:$("#amount").val()},function(t){workbyadd=JSON.parse(t),"success"==workbyadd.worked?(noty({text:"Успешное добавление!"}),$("#work_class").val(""),$("#author").val(""),$("#subject").val(""),$("#year_add").val(""),$("#shelf_life").val(""),$("#publishing").val(""),$("#amount").val("")):noty({text:"Произошла ошибка при добавлении!"})}):noty({text:"Вы ввели некорректные данные!"})})}),footerToBottom(),$(window).resize(function(){footerToBottom()});